{"version":3,"sources":["PlotCanvas.js","PlotSVG.js","App.js","index.js"],"names":["PlotCanvas","props","ref","useRef","xScale","d3","domain","range","yScale","shape","data","size","opacity","useEffect","draw","width","height","oldAlpha","t0","Date","now","g","current","getContext","globalAlpha","clearRect","lineWidth","strokeStyle","forEach","datum","beginPath","x","Math","round","y","moveTo","arc","PI","strokeRect","stroke","t1","fillStyle","font","fillText","PlotSVG","svg","allShapes","selectAll","length","remove","append","attr","style","select","text","App","useState","setSize","getData","getPower","setData","setOpacity","className","Slider","defaultValue","step","min","max","valueLabelDisplay","marks","onChangeCommitted","event","value","valueLabelFormat","href","n","f","i","exp","floor","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.40887c9d.chunk.js","sourcesContent":["import React, { useRef, useEffect }  from 'react';\nimport * as d3 from 'd3';\nimport './PlotCanvas.css';\n\n/**\n * Scatter plot in a CANVAS element.\n *\n * @param  {Object}  props  properties\n * @return component\n */\nconst PlotCanvas = ( props ) => {\n    \n    // Create reference and scales.\n    const width = 300, height = 300;\n    let ref = useRef(),\n        xScale = d3.scaleLinear().domain([ 0, 1 ]).range([ 0, width ]),\n        yScale = d3.scaleLinear().domain([ 0, 1 ]).range([ height, 0 ]),\n        { shape, data, size, opacity } = props;\n    \n    // Hook to draw on mounting, or on any other lifecycle update.\n    useEffect(() => {\n        PlotCanvas.draw( width, height, ref, xScale, yScale, shape, data, size, opacity );\n    });\n                         \n    // Return the component.\n    return <canvas width={width} height={height} ref={ref}></canvas>;\n}\n\n/**\n * Draws the points and the time.\n *\n * @param {number}     width    width in pixels\n * @param {number}     height   height in pixels\n * @param {Array}      ref      reference to SVG element\n * @param {d3.scale*}  xScale   X scale\n * @param {d3.scale*}  yScale   Y scale\n * @param {string}     shape    one of \"circle\", \"square\"\n * @param {Array}      data     Array of x, y values between 0 and 1\n * @param {number}     size     size in pixels\n * @param {number}     opacity  one of \"circle\", \"square\"\n */\nPlotCanvas.draw = ( width, height, ref, xScale, yScale, shape, data, size, opacity ) => {\n    \n    // Draw the points.  +0.5 minimizes anti-aliasing.\n    let t0 = Date.now(),\n        canvas = ref.current,\n        g = canvas.getContext( \"2d\" ),\n        oldAlpha;\n    if( g ) {\n        oldAlpha = g.globalAlpha;\n        g.clearRect( 0, 0, width, height );\n        g.lineWidth = 1;\n        g.strokeStyle = \"#000000\";\n        g.globalAlpha = opacity;\n        data.forEach( datum => {\n            g.beginPath();\n            let x = Math.round( xScale( datum[ 0 ])) + 0.5,\n                y = Math.round( yScale( datum[ 1 ])) + 0.5;\n            if( shape === \"circle\" ) {\n                g.moveTo( x + size / 2, y );\n                g.arc( x, y, size / 2, 0, 2 * Math.PI, true );\n            } else {\n                g.strokeRect( x, y, size, size );\n            }\n            g.stroke();\n        });\n        g.globalAlpha = oldAlpha;\n        let t1 = Date.now() - t0;\n                         \n        // Draw the time.\n        g.fillStyle = \"#000000\";\n        g.font = \"16px sans-serif\";\n        g.fillText( \"CANVAS \" + shape + \"s: \" + t1 + \" msec\", 10, height - 10 );\n    }\n}\n\nexport default PlotCanvas;\n","import React, { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\nimport './PlotSVG.css';\n\n/**\n * Scatter plot in an SVG element.\n *\n * @param  {Object}  props  properties\n * @return component\n */\nconst PlotSVG = ( props ) => {\n    \n    // Create reference and scales.\n    const width = 300, height = 300;\n    let ref = useRef(),\n        xScale = d3.scaleLinear().domain([ 0, 1 ]).range([ 0, width ]),\n        yScale = d3.scaleLinear().domain([ 0, 1 ]).range([ height, 0 ]),\n        { shape, data, size, opacity } = props;\n    \n    // Set hook to draw on mounting.\n    useEffect(() => {\n        PlotSVG.draw( height, ref, xScale, yScale, shape, data, size, opacity );\n    });\n    \n    // Return the component.\n    return <svg width={width} height={height} ref={ref}></svg>;\n};\n\n/**\n * Draws the points and the time.\n *\n * @param {number}     height   height in pixels\n * @param {Array}      ref      reference to SVG element\n * @param {d3.scale*}  xScale   X scale\n * @param {d3.scale*}  yScale   Y scale\n * @param {string}     shape    one of \"circle\", \"square\"\n * @param {Array}      data     Array of x, y values between 0 and 1\n * @param {number}     size     size in pixels\n * @param {number}     opacity  one of \"circle\", \"square\"\n */\nPlotSVG.draw = ( height, ref, xScale, yScale, shape, data, size, opacity ) => {\n    \n    // If the data changed, re-create the SVG elements.  +0.5 minimizes anti-aliasing.\n    const svg = d3.select( ref.current );\n    let allShapes = svg.selectAll(( shape === \"circle\" ) ? \"circle\" : \"rect\" );\n    if( allShapes.size() !== data.length ) {\n        allShapes.remove();\n        if( shape === \"circle\" ) {\n            data.forEach(( datum ) => {\n                svg.append( \"circle\" )\n                    .attr( \"cx\", Math.round( xScale( datum[ 0 ]) + 0.5 ))\n                    .attr( \"cy\", Math.round( yScale( datum[ 1 ]) + 0.5 ))\n                    .style( \"fill\", \"none\" )\n                    .style( \"stroke\", \"black\" );\n            });\n        } else {\n            data.forEach(( datum ) => {\n                svg.append( \"rect\" )\n                    .attr( \"x\", Math.round( xScale( datum[ 0 ]) + 0.5 ))\n                    .attr( \"y\", Math.round( yScale( datum[ 1 ]) + 0.5 ))\n                    .style( \"fill\", \"none\" )\n                    .style( \"stroke\", \"black\" );\n            });\n        }\n        svg.selectAll( \"text\" ).remove();\n        svg.append( \"text\" );\n    }\n        \n    // Draw the points.\n    let t0 = Date.now();\n    if( shape === \"circle\" ) {\n        svg.selectAll( \"circle\" )\n            .attr( \"r\", size / 2 )\n            .style( \"opacity\", opacity )\n    } else {\n        svg.selectAll( \"rect\" )\n            .attr( \"width\", size )\n            .attr( \"height\", size )\n            .style( \"opacity\", opacity )\n    }\n    let t1 = Date.now() - t0;\n                  \n    // Draw the time.\n    svg.select( \"text\" )\n        .attr( \"x\", 10 )\n        .attr( \"y\", height - 10 )\n        .text( \"SVG \" + shape + \"s: \" + t1 + \"  msec\" );\n};\n\nexport default PlotSVG;\n","import React, { useState } from 'react';\nimport { Slider } from '@material-ui/core';\nimport * as d3 from 'd3';\nimport PlotCanvas from './PlotCanvas';\nimport PlotSVG from './PlotSVG';\nimport './App.css';\n\n/**\n * A grid of performance tests.\n */\nconst App = () => {\n    \n    // Create state.\n    const [ size, setSize ] = useState( 4 );\n    const [ data, setData ] = useState( App.getData( App.getPower( 9 )));\n    const [ opacity, setOpacity ] = useState( 0.4 );\n    \n    // Return the App.\n    return (\n        <div className=\"Column\">\n            <div className=\"GridPlots\">\n                <PlotSVG    shape={\"circle\"} size={size} data={data} opacity={opacity} />\n                <PlotCanvas shape={\"circle\"} size={size} data={data} opacity={opacity} />\n                <PlotSVG    shape={\"square\"} size={size} data={data} opacity={opacity} />\n                <PlotCanvas shape={\"square\"} size={size} data={data} opacity={opacity} />\n            </div>\n            <div className=\"GridControls\">\n                <label>Size:</label>\n                <Slider defaultValue={ 4 } step={ 1 } min={ 0 } max={ 10 }\n                    valueLabelDisplay=\"auto\" marks\n                    onChangeCommitted={( event, value ) => setSize( value )} />\n                <label>Points:</label>\n                <Slider defaultValue={ 9 } step={ 1 } min={ 0 } max={ 15 }\n                    valueLabelDisplay=\"auto\" marks valueLabelFormat={( value ) => App.getPower( value )}\n                    onChangeCommitted={( event, value ) => setData( App.getData( App.getPower( value )))} />\n                <label>Opacity:</label>\n                <Slider defaultValue={ 0.4 } step={ 0.01 } min={ 0 } max={ 1 }\n                    valueLabelDisplay=\"auto\"\n                    onChangeCommitted={( event, value ) => setOpacity( value )} />\n            </div>\n            <div className=\"Description\">\n                <p>\n                Scatter plots have been used to display up to 1,000,000 data points (for example, <a href=\"https://www.highcharts.com/demo/android/scatter-boost\">here</a> and <a href=\"https://blog.scottlogic.com/2020/05/01/rendering-one-million-points-with-d3.html\">here</a>.  With suitably adjusted point size and opacity, these plots are superior to contour plots because they show both the structure of the data and the individual points.\n                </p>\n                <p>\n                Even in modern browsers, the SVG element cannot support such large data sets.  This type of plot requires a CANVAS element.  The performance difference becomes critical during user interactions such as brushing.\n                </p>\n            </div>\n        </div>\n    );\n}\n\n/**\n * Generates bivariate random normal data.\n *\n * @param  {number}  n  number of values\n * @return {Array}  Array of x, y values between 0 and 1\n */\nApp.getData = ( n ) => {\n    let data = [],\n        f = d3.randomNormal( 0.5, 0.1 );\n    for( let i = 0; ( i < n ); i++ ) {\n        data[ i ] = [ f(), f()];\n    }\n    return data;\n}\n\n/**\n * Returns \"nice\" power of ten:  rounded to 1, 2, 5, 10, 20, 50, etc.\n *\n * @param  {number}  exp  exponent\n * @return {number}  \"nice\" power of ten:  rounded to 1, 2, 5, 10, 20, 50, etc.\n */\nApp.getPower = ( exp ) => {\n    let m = (( exp % 3 ) === 0 ) ? 1 : (( exp % 3 ) === 1 ) ? 2 : 5;\n    return m * ( 10 ** Math.floor( exp / 3 ));\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\n// Render the app.\nReactDOM.render(\n    <React.StrictMode>\n        <App />\n    </React.StrictMode>,\n    document.getElementById( 'root' )\n);\n"],"sourceRoot":""}